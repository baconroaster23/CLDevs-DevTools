// CLDevs External Check Out His Vids He has an Tutorial

using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using System.Xml;

/*
 * soo uhhhh yes this is an external
 * made by @speednextdoor on dc and yt
 * All Love to @speednextdoor
 */

namespace rbx_external
{
    public class offsets // get them from extenral servers they provide u with offsets
    {
        public static readonly int Adornee = 0xD8;
        public static readonly int Anchored = 0x2F9;
        public static readonly int AnimationId = 0xD8;
        public static readonly int AttributeList = 0x138;
        public static readonly int AttributeToNext = 0x70;
        public static readonly int AttributeToValue = 0x30;
        public static readonly int AutoJumpEnabled = 0x1E3;
        public static readonly int BeamBrightness = 0x198;
        public static readonly int BeamColor = 0x128;
        public static readonly int BeamLightEmission = 0x1A4;
        public static readonly int BeamLightInfuence = 0x1A8;
        public static readonly int Camera = 0x420;
        public static readonly int CameraMaxZoomDistance = 0x2D0;
        public static readonly int CameraMinZoomDistance = 0x2D4;
        public static readonly int CameraMode = 0x2D8;
        public static readonly int CameraPos = 0x124;
        public static readonly int CameraRotation = 0x100;
        public static readonly int CameraSubject = 0xF0;
        public static readonly int CameraType = 0x160;
        public static readonly int CanCollide = 0x2FB;
        public static readonly int CanTouch = 0x2FC;
        public static readonly int CharacterAppearanceId = 0x278;
        public static readonly int Children = 0x80;
        public static readonly int ChildrenEnd = 0x8;
        public static readonly int ClassDescriptor = 0x18;
        public static readonly int ClassDescriptorToClassName = 0x8;
        public static readonly int ClickDetectorMaxActivationDistance = 0x118;
        public static readonly int ClockTime = 0x1C0;
        public static readonly int CreatorId = 0x190;
        public static readonly int DataModelDeleterPointer = 0x6833730;
        public static readonly int DataModelPrimitiveCount = 0x410;
        public static readonly int DataModelToRenderView1 = 0x1D8;
        public static readonly int DataModelToRenderView2 = 0x8;
        public static readonly int DataModelToRenderView3 = 0x28;
        public static readonly int DecalTexture = 0x110;
        public static readonly int Deleter = 0x10;
        public static readonly int DeleterBack = 0x18;
        public static readonly int Dimensions = 0x720;
        public static readonly int DisplayName = 0x118;
        public static readonly int EvaluateStateMachine = 0x1E3;
        public static readonly int FOV = 0x168;
        public static readonly int FakeDataModelPointer = 0x6833728;
        public static readonly int FakeDataModelToDataModel = 0x1C0;
        public static readonly int FogColor = 0x104;
        public static readonly int FogEnd = 0x13C;
        public static readonly int FogStart = 0x140;
        public static readonly int ForceNewAFKDuration = 0x0;
        public static readonly int FramePositionOffsetX = 0x3BC;
        public static readonly int FramePositionOffsetY = 0x3C4;
        public static readonly int FramePositionX = 0x3B8;
        public static readonly int FramePositionY = 0x3C0;
        public static readonly int FrameRotation = 0x190;
        public static readonly int FrameSizeX = 0x120;
        public static readonly int FrameSizeY = 0x124;
        public static readonly int GameId = 0x198;
        public static readonly int GameLoaded = 0x698;
        public static readonly int Gravity = 0x960;
        public static readonly int Health = 0x19C;
        public static readonly int HealthDisplayDistance = 0x2F8;
        public static readonly int HipHeight = 0x1A8;
        public static readonly int HumanoidDisplayName = 0xD8;
        public static readonly int HumanoidState = 0x870;
        public static readonly int HumanoidStateId = 0x20;
        public static readonly int InputObject = 0x108;
        public static readonly int InsetMaxX = 0x108;
        public static readonly int InsetMaxY = 0x10C;
        public static readonly int InsetMinX = 0x100;
        public static readonly int InsetMinY = 0x104;
        public static readonly int InstanceCapabilities = 0x380;
        public static readonly int JobEnd = 0x1D8;
        public static readonly int JobId = 0x140;
        public static readonly int JobStart = 0x1D0;
        public static readonly int Job_Name = 0x18;
        public static readonly int JobsPointer = 0x6903670;
        public static readonly int JumpPower = 0x1B8;
        public static readonly int LocalPlayer = 0x128;
        public static readonly int LocalScriptByteCode = 0x1B0;
        public static readonly int LocalScriptBytecodePointer = 0x10;
        public static readonly int LocalScriptHash = 0x1C0;
        public static readonly int MaterialType = 0x2D8;
        public static readonly int MaxHealth = 0x1BC;
        public static readonly int MaxSlopeAngle = 0x1C0;
        public static readonly int MeshPartColor3 = 0x9A8;
        public static readonly int ModelInstance = 0x340;
        public static readonly int ModuleScriptByteCode = 0x158;
        public static readonly int ModuleScriptBytecodePointer = 0x10;
        public static readonly int ModuleScriptHash = 0x180;
        public static readonly int MoonTextureId = 0xE0;
        public static readonly int MousePosition = 0xF4;
        public static readonly int MouseSensitivity = 0x0;
        public static readonly int MoveDirection = 0x160;
        public static readonly int Name = 0x78;
        public static readonly int NameDisplayDistance = 0x304;
        public static readonly int NameSize = 0x10;
        public static readonly int OnDemandInstance = 0x30;
        public static readonly int OutdoorAmbient = 0x110;
        public static readonly int Parent = 0x50;
        public static readonly int PartSize = 0x298;
        public static readonly int Ping = 0xD0;
        public static readonly int PlaceId = 0x1A0;
        public static readonly int PlayerConfigurerPointer = 0x6811268;
        public static readonly int PlayerMouse = 0xC00;
        public static readonly int Position = 0x13C;
        public static readonly int Primitive = 0x178;
        public static readonly int PrimitiveGravity = 0x110;
        public static readonly int PrimitiveValidateValue = 0x6;
        public static readonly int PrimitivesPointer1 = 0x3A8;
        public static readonly int PrimitivesPointer2 = 0x210;
        public static readonly int ProximityPromptActionText = 0xD8;
        public static readonly int ProximityPromptEnabled = 0x14A;
        public static readonly int ProximityPromptGamepadKeyCode = 0x134;
        public static readonly int ProximityPromptHoldDuraction = 0x138;
        public static readonly int ProximityPromptMaxActivationDistance = 0x140;
        public static readonly int ProximityPromptMaxObjectText = 0xF8;
        public static readonly int RenderJobToDataModel = 0x1B0;
        public static readonly int RenderJobToFakeDataModel = 0x38;
        public static readonly int RenderJobToRenderView = 0x218;
        public static readonly int RequireBypass = 0x7D8;
        public static readonly int RigType = 0x1D0;
        public static readonly int Rotation = 0x120;
        public static readonly int RunContext = 0x150;
        public static readonly int ScriptContext = 0x3B0;
        public static readonly int Sit = 0x1E3;
        public static readonly int SkyboxBk = 0x108;
        public static readonly int SkyboxDn = 0x130;
        public static readonly int SkyboxFt = 0x158;
        public static readonly int SkyboxLf = 0x180;
        public static readonly int SkyboxRt = 0x1A8;
        public static readonly int SkyboxUp = 0x1D0;
        public static readonly int SoundId = 0xE0;
        public static readonly int StarCount = 0x228;
        public static readonly int StringLength = 0x10;
        public static readonly int SunTextureId = 0x1F8;
        public static readonly int TagList = 0x120;
        public static readonly int TaskSchedulerMaxFPS = 0x1B0;
        public static readonly int TaskSchedulerPointer = 0x6903490;
        public static readonly int Team = 0x268;
        public static readonly int TeamColor = 0xD8;
        public static readonly int Tool_Grip_Position = 0x454;
        public static readonly int Transparency = 0xF8;
        public static readonly int UserId = 0x288;
        public static readonly int Value = 0xD8;
        public static readonly int Velocity = 0x148;
        public static readonly int ViewportSize = 0x300;
        public static readonly int VisualEngine = 0x10;
        public static readonly int VisualEnginePointer = 0x6676BC8;
        public static readonly int VisualEngineToDataModel1 = 0x700;
        public static readonly int VisualEngineToDataModel2 = 0x1C0;
        public static readonly int WalkSpeed = 0x1DC;
        public static readonly int WalkSpeedCheck = 0x3B8;
        public static readonly int WhitelistEncryption = 0x3DC80039;
        public static readonly int WhitelistEncryption2 = 0x79;
        public static readonly int WhitelistSetInsert = 0xCAA3F0;
        public static readonly int WhitelistedPages = 0x2B92E0;
        public static readonly int WhitelistedThreads = 0x2B77F8;
        public static readonly int Workspace = 0x180;
        public static readonly int WorkspaceToWorld = 0x3A8;
        public static readonly int viewmatrix = 0x4B0;
    }

    public class memory 
    {
        public static IntPtr handle = IntPtr.Zero;
        public static int pid = 0;

        // just sm imports :p
        // nvm
        [DllImport("kernel32.dll")]
        public static extern IntPtr OpenProcess(int fuckidk, bool a2, int processid);

        [DllImport("kernel32.dll")]
        public static extern bool ReadProcessMemory(IntPtr prc, IntPtr addy, byte[] buffer, int size, out int writen);

        [DllImport("kernel32.dll")]
        public static extern bool WriteProcessMemory(IntPtr prc, IntPtr addy, byte[] buffer, int size, out int writen);

        // 100% injection im making rn :100:
        public static bool attach() // yeah we attach :100: a dll to roblox :100:
        {
            var processes = Process.GetProcessesByName("RobloxPlayerBeta");
            if (processes.Length == 0)
            {
                return false;
            }

            var process = processes[0];
            pid = process.Id;
            handle = OpenProcess(0x1F0FFF, false, pid); 
            return handle != IntPtr.Zero;
        }

        public static void detach()
        {
            pid = 0x000000;
            handle = IntPtr.Zero;
        }

        // now we make simple operations like reading and writigin memory
        public static T read<T>(IntPtr addy) where T : struct
        {
            int size = Marshal.SizeOf(typeof(T));
            byte[] buff = new byte[size];
            ReadProcessMemory(handle, addy, buff, size, out int readlen);
            GCHandle gch = GCHandle.Alloc(buff, GCHandleType.Pinned);
            T value = Marshal.PtrToStructure<T>(gch.AddrOfPinnedObject());
            return value;
        }

        public static bool write<T>(IntPtr addy, T value) where T : struct // ok
        {
            int size = Marshal.SizeOf(typeof(T));
            byte[] buff = new byte[size];
            IntPtr pointer = Marshal.AllocHGlobal(size);
            Marshal.StructureToPtr(value, pointer, false);
            Marshal.Copy(pointer, buff, 0, size);
            Marshal.FreeHGlobal(pointer);
            return WriteProcessMemory(handle, addy, buff, size, out int ffff) && ffff == size;
        }

        public static string readstring(IntPtr addy, int max = 200) // compiler fucking stupid lool 
        {
            StringBuilder sb = new StringBuilder();
            for (int i = 0; i < max; i++)
            {
                byte[] buff = new byte[1];
                ReadProcessMemory(handle, (IntPtr)((long)addy + i), buff, 1, out int _);

                if (buff[0] == 0)
                    break;
                sb.Append((char)buff[0]);
            }
            return sb.ToString(); //fuck im outta storage brb
        }

        public static IntPtr getrobloxbaseaddy()
        {
            Process process = Process.GetProcessById(pid);
            foreach (ProcessModule mod in process.Modules)
            {
                if (mod.ModuleName.Equals("RobloxPlayerBeta.exe", StringComparison.OrdinalIgnoreCase)) 
                    return mod.BaseAddress;
            }
            return IntPtr.Zero;//f
        }
    }

    public class instance // common instances. WILL be adding more like set value, get value, etc
    {
        public IntPtr address;

        public instance(IntPtr addy)
        {
            address = addy;
        }

        public string name()
        {
            var ptr = memory.read<IntPtr>(address + offsets.Name);
            return ptr != IntPtr.Zero ? memory.readstring(ptr) : string.Empty; // u can add custom shit if it canat grab it
        }

        public instance parent()
        {
            return new instance(memory.read<IntPtr>(address + offsets.Parent));
        }

        public List<instance> getchildren()
        {
            var children = new List<instance>();
            var start = memory.read<ulong>(address + offsets.Children);
            var end = memory.read<ulong>((IntPtr)start + offsets.ChildrenEnd);

            for (ulong ptr = memory.read<ulong>((IntPtr)start); ptr != end; ptr += 0x10)
            {
                var childaddy = memory.read<ulong>((IntPtr)ptr);
                children.Add(new instance((IntPtr)childaddy));
            }

            return children;
        }

        public instance findfirstchild(string name)
        {
            foreach (var child in getchildren())
            {
                if (child.name() == name)
                    return child;
            }
            return new instance(IntPtr.Zero);
        }

        class rbx
        {
            // write ur service names here ig
            // these are simple but yk 
            public static IntPtr datamodel;
            public static IntPtr humanoid;
            public static IntPtr workspace;
            public static IntPtr coregui;

            public static IntPtr getdatamodel() // i will teach later how to get scheduler too or script context its easier
            {
                var fakeahhdm = memory.read<IntPtr>(memory.getrobloxbaseaddy() + offsets.FakeDataModelPointer);
                return memory.read<IntPtr>(fakeahhdm + offsets.FakeDataModelToDataModel);
            }

            public static void walkspeed(float speed) // getting services i suggest making a seperate func that sets the services addreesses so u dont need to "rescan" for em
            {
                datamodel = getdatamodel(); // yikes

                var dm = new instance(datamodel);
                var wrkspce = dm.findfirstchild("Workspace");
                var plrs = dm.findfirstchild("Players");

                var localplr = memory.read<IntPtr>(plrs.address + offsets.LocalPlayer);
                var plrinstance = new instance(localplr);
                var charac = wrkspce.findfirstchild(plrinstance.name());
                var human = charac.findfirstchild("Humanoid");

                workspace = wrkspce.address;
                humanoid = human.address;


                memory.write(human.address + offsets.WalkSpeed, speed);
                memory.write(human.address + offsets.WalkSpeedCheck, speed);
            }
        }

        internal class Program
        {
            static void Main(string[] args)
            {
                Console.Title = "rbx external.exe (64 bit)";

                if (!memory.attach())
                {
                    Console.ForegroundColor = ConsoleColor.DarkRed;
                    Console.WriteLine("[external] no clue what happened.");
                    Thread.Sleep(3000);
                    Environment.Exit(-1);
                }

                Console.ForegroundColor = ConsoleColor.Green;
                Console.WriteLine("[ext] ATTACHED TO ROBLOX.");

                Console.ForegroundColor = ConsoleColor.White;
                Console.WriteLine("[1] set walkspeed");
                Console.WriteLine("[2] exit");

                var input = Console.ReadLine();
                if (input == "1")
                {
                    Console.Write("[!] how much speed: ");
                    float speed = float.Parse(Console.ReadLine());
                    
                    rbx.walkspeed(speed);
                    Console.WriteLine("[!] DONE!");
                    Console.ReadKey();

                }
                else if (input == "2")
                {
                    Environment.Exit(1);
                }
                else if (input == "3") // hahahaahahaha no
                {
                    Environment.Exit(1);
                }
            }
        }
    }
}
